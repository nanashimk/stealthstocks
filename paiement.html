<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Paiement ‚Äî Legit Flow</title>
<meta name="description" content="Finaliser votre commande ‚Äî Legit Flow." />
<style>
:root{ --bg:#ffffff; --text:#101418; --muted:#6b7280; --radius:18px; --accent:#111; }
*{ box-sizing:border-box; }
body{ margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color:var(--text); background:var(--bg); }
.container{ width:min(900px, 95vw); margin:0 auto; }
header{ position:sticky; top:0; z-index:30; backdrop-filter:saturate(120%) blur(8px); background:rgba(255,255,255,.85); border-bottom:1px solid #eee; }
.nav{ display:flex; align-items:center; justify-content:space-between; padding:8px 0; }
.brand{ display:inline-flex; align-items:center; gap:.6rem; font-weight:700; letter-spacing:.2px; }
.dot{ width:28px; height:28px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #79f, #5af); box-shadow: 0 6px 18px rgba(60,100,255,.22); }
.actions{ display:flex; gap:8px; align-items:center; }
.btn, .cta{ border:1px solid var(--accent); color:var(--accent); background:#fff; border-radius:999px; padding:8px 12px; text-decoration:none; display:inline-flex; align-items:center; gap:.5rem; }
.badge{ display:inline-grid; place-items:center; min-width:24px; height:24px; padding:0 6px; border-radius:999px; border:1px solid #ddd; font-size:.8rem; }

main{ padding:24px 0 56px; }
h1{ font-size:clamp(1.3rem, 2vw + .6rem, 2.1rem); margin:0 0 8px; font-weight:800; }
.kicker{ color:var(--muted); text-transform:uppercase; letter-spacing:.2em; font-size:.8rem; }

.card{ border:1px solid #eee; border-radius:14px; padding:16px; background:#fafafa; }
.grid{ display:grid; grid-template-columns:1fr; gap:16px; }
label{ font-weight:600; font-size:.92rem; }
input, textarea{ width:100%; border:1px solid #ddd; border-radius:12px; padding:10px 12px; font: inherit; background:#fff; }
small{ color:#6b7280; }

.list{ margin:12px 0 0; padding:0; list-style:none; }
.list li{ display:flex; align-items:center; justify-content:space-between; padding:10px 0; border-bottom:1px solid #eee; }
.total{ font-weight:800; }

.actions-row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
button.linklike{ border:1px solid var(--accent); background:#fff; color:#111; border-radius:999px; padding:10px 14px; cursor:pointer; }
.secondary{ border-color:#ddd; }

.note{ color:#6b7280; font-size:.9rem; margin-top:6px; }
.preview{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; white-space: pre-wrap; border:1px dashed #ddd; border-radius:12px; padding:12px; background:#fff; }
</style>
</head>
<body>
<header>
  <div class="container nav">
    <div class="brand"><div class="dot"></div><span>Legit Flow</span></div>
    <div class="actions">
      <a class="btn" href="index.html">Vitrine</a>
      <a class="btn" href="panier.html">Panier <span id="mini-count" class="badge">0</span></a>
      <a class="cta" href="paiement.html">Paiement</a>
    </div>
  </div>
</header>

<main class="container">
  <div class="kicker">Finalisation</div>
  <h1>Paiement / Envoi de commande</h1>

  <div class="grid">
    <section class="card">
      <label>Vos infos (facultatif)</label>
      <div class="grid" style="grid-template-columns: repeat(2, minmax(0, 1fr));">
        <input id="fname" placeholder="Pr√©nom" />
        <input id="lname" placeholder="Nom" />
      </div>
      <input id="phone" placeholder="T√©l√©phone" style="margin-top:8px;" />
      <textarea id="note" rows="3" placeholder="Message au vendeur (optionnel)" style="margin-top:8px;"></textarea>
      <small>Ces champs seront ajout√©s au message.</small>
    </section>

    <section class="card">
      <label>Votre s√©lection</label>
      <ul id="items" class="list"></ul>
      <div style="display:flex; align-items:center; justify-content:space-between; padding-top:10px;">
        <div class="total">Total : <span id="grand">0‚Ç¨</span></div>
        <a href="panier.html" class="btn secondary">Modifier le panier</a>
      </div>
    </section>

    <section class="card">
      <label>Aper√ßu du message</label>
      <div id="preview" class="preview"></div>

      <div class="actions-row">
        <button id="sendEmail" class="linklike">‚úâÔ∏è Envoyer par e‚Äëmail</button>
        <button id="sendSMS" class="linklike">üì± Envoyer par SMS</button>
        <button id="copy" class="linklike secondary">Copier le message</button>
        <button id="clear" class="linklike secondary">Vider le panier</button>
      </div>
      <div class="note">L‚Äôe‚Äëmail s‚Äôouvrira dans votre application de messagerie avec le contenu pr√©rempli √† l‚Äôadresse <strong>cbmda.wathces@gmail.com</strong>. Le SMS s‚Äôouvre vers <strong>07&nbsp;66&nbsp;16&nbsp;76&nbsp;34</strong> (selon l‚Äôappareil).</div>
    </section>
  </div>
</main>

<script>
const EMAIL = "cbmda.wathces@gmail.com";
const PHONE_SMS = "+33766167634"; // format international pour compatibilit√©

function getCart(){ try { return JSON.parse(localStorage.getItem('cart')||'{}'); } catch(e){ return {}; } }
function updateMiniCount(){ 
  const c = getCart(); 
  const total = Object.values(c).reduce((s, it) => s + (it.qty||0), 0);
  const badge = document.getElementById('mini-count');
  if(badge) badge.textContent = total;
}

function euro(n){ return (Math.round(n*100)/100).toFixed(2).replace('.', ',') + '‚Ç¨'; }

function buildLines(cart){
  const lines = [];
  let total = 0;
  Object.values(cart).forEach(it=>{
    const line = `- ${it.title} √ó ${it.qty} @ ${it.price}‚Ç¨ = ${euro(it.qty*it.price).replace(',00','')}`;
    lines.push(line);
    total += it.qty*it.price;
  });
  return { lines, total };
}

function render(){
  updateMiniCount();
  const items = document.getElementById('items');
  const grand = document.getElementById('grand');
  const prev = document.getElementById('preview');
  const cart = getCart();
  items.innerHTML = '';

  const { lines, total } = buildLines(cart);

  if(Object.keys(cart).length === 0){
    items.innerHTML = '<li style="color:#6b7280">Aucun article.</li>';
    grand.textContent = '0‚Ç¨';
  }else{
    Object.values(cart).forEach(it=>{
      const li = document.createElement('li');
      li.innerHTML = `<span>${it.title} √ó ${it.qty}</span><span>${euro(it.qty*it.price).replace(',00','')}</span>`;
      items.appendChild(li);
    });
    grand.textContent = euro(total).replace(',00','');
  }

  // construire message
  const fname = document.getElementById('fname').value.trim();
  const lname = document.getElementById('lname').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const note = document.getElementById('note').value.trim();

  const who = (fname || lname) ? `${fname} ${lname}`.trim() : '';
  const header = `Commande Legit Flow` + (who?` ‚Äî ${who}`:'');
  const info = phone ? `T√©l√©phone: ${phone}\n` : '';
  const noteLine = note ? `\nNote: ${note}\n` : '';
  const list = lines.length? lines.join('\n') : '(panier vide)';
  const footer = `\nTotal: ${euro(total).replace(',00','')}`;

  const text = `${header}\n${info}${noteLine}\nArticles:\n${list}${footer}`.trim();
  prev.textContent = text;

  // Mettre √† jour actions
  const subj = encodeURIComponent('Commande Legit Flow');
  const body = encodeURIComponent(text);
  const mailto = `mailto:${EMAIL}?subject=${subj}&body=${body}`;
  const sms = `sms:${PHONE_SMS}?&body=${body}`;

  const sendEmail = document.getElementById('sendEmail');
  const sendSMS = document.getElementById('sendSMS');
  sendEmail.onclick = ()=>{ window.location.href = mailto; };
  sendSMS.onclick = ()=>{ window.location.href = sms; };

  document.getElementById('copy').onclick = async ()=>{
    try{ await navigator.clipboard.writeText(text); alert('Message copi√©.'); }catch(e){ alert('Copie impossible, s√©lectionnez et copiez manuellement.'); }
  };
  document.getElementById('clear').onclick = ()=>{ localStorage.removeItem('cart'); render(); };
}

['fname','lname','phone','note'].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('input', render);
});

render();
</script>
</body>
</html>
