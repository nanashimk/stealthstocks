<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Panier — Legit Flow</title>
<meta name="description" content="Votre panier — Legit Flow." />
<style>
:root{ --bg:#ffffff; --text:#101418; --muted:#6b7280; --radius:18px; --accent:#111; }
*{ box-sizing:border-box; }
body{ margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color:var(--text); background:var(--bg); }
.container{ width:min(1200px, 95vw); margin:0 auto; }
header{ position:sticky; top:0; z-index:30; backdrop-filter:saturate(120%) blur(8px); background:rgba(255,255,255,.85); border-bottom:1px solid #eee; }
.nav{ display:flex; align-items:center; justify-content:space-between; padding:8px 0; }
.brand{ display:inline-flex; align-items:center; gap:.6rem; font-weight:700; letter-spacing:.2px; }
.dot{ width:28px; height:28px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #79f, #5af); box-shadow: 0 6px 18px rgba(60,100,255,.22); }
.actions{ display:flex; gap:8px; align-items:center; }
.btn, .cta{ border:1px solid var(--accent); color:var(--accent); background:#fff; border-radius:999px; padding:8px 12px; text-decoration:none; display:inline-flex; align-items:center; gap:.5rem; }
.badge{ display:inline-grid; place-items:center; min-width:24px; height:24px; padding:0 6px; border-radius:999px; border:1px solid #ddd; font-size:.8rem; }

main{ padding:24px 0 56px; }
h1{ font-size:clamp(1.3rem, 2vw + .6rem, 2.1rem); margin:0 0 8px; font-weight:800; }
.kicker{ color:var(--muted); text-transform:uppercase; letter-spacing:.2em; font-size:.8rem; }

.table{ width:100%; border-collapse: collapse; margin-top:16px; }
.table th, .table td{ border-bottom:1px solid #eee; padding:12px 8px; text-align:left; vertical-align:middle; }
.table th{ color:#6b7280; font-weight:600; font-size:.9rem; }
.item{ display:flex; align-items:center; gap:12px; }
.item img{ width:64px; height:64px; object-fit:cover; border-radius:12px; border:1px solid #eee; background:#fff; }

.qty{ display:inline-flex; border:1px solid #ccc; border-radius:999px; overflow:hidden; }
.qty button{ background:#fff; border:0; padding:6px 10px; cursor:pointer; }
.qty input{ width:44px; text-align:center; border:0; outline:none; padding:6px; }

.row-actions{ display:flex; gap:8px; align-items:center; }
.remove{ background:transparent; border:0; color:#ef4444; cursor:pointer; }

.summary{ margin-top:20px; display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
.total{ font-size:1.15rem; font-weight:800; }
.controls{ display:flex; gap:8px; flex-wrap:wrap; }
.secondary{ border:1px solid #ddd; }
.empty{ text-align:center; padding:32px 0 48px; color:#6b7280; }

@media (max-width:720px){
  .hide-sm{ display:none; }
}
</style>
</head>
<body>
<header>
  <div class="container nav">
    <div class="brand"><div class="dot"></div><span>Legit Flow</span></div>
    <div class="actions">
      <a class="btn" href="index.html">Vitrine</a>
      <a class="btn" href="panier.html">Panier <span id="mini-count" class="badge">0</span></a>
      <a class="cta" href="paiement.html">Paiement</a>
    </div>
  </div>
</header>

<main class="container">
  <div class="kicker">Votre panier</div>
  <h1>Récapitulatif</h1>

  <div id="empty" class="empty" style="display:none;">Votre panier est vide.</div>

  <table class="table" id="cartTable" style="display:none;">
    <thead>
      <tr>
        <th>Article</th>
        <th class="hide-sm">Prix</th>
        <th>Qté</th>
        <th>Total</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="cartBody"></tbody>
  </table>

  <div class="summary" id="summary" style="display:none;">
    <div class="total" id="grandTotal">Total : 0€</div>
    <div class="controls">
      <a class="btn secondary" href="index.html">← Continuer</a>
      <button id="clear" class="btn secondary" type="button">Vider le panier</button>
      <a class="cta" href="paiement.html">Passer au paiement →</a>
    </div>
  </div>
</main>

<script>
function getCart(){ try { return JSON.parse(localStorage.getItem('cart')||'{}'); } catch(e){ return {}; } }
function setCart(c){ localStorage.setItem('cart', JSON.stringify(c)); render(); }
function updateMiniCount(){ 
  const c = getCart(); 
  const total = Object.values(c).reduce((s, it) => s + (it.qty||0), 0);
  const badge = document.getElementById('mini-count');
  if(badge) badge.textContent = total;
}

function formatEuro(n){ return (Math.round(n*100)/100).toFixed(2).replace('.', ',') + '€'; }

function changeQty(id, delta){
  const cart = getCart();
  if(!cart[id]) return;
  cart[id].qty = Math.max(0, (cart[id].qty||0) + delta);
  if(cart[id].qty === 0) delete cart[id];
  setCart(cart);
}

function setQty(id, val){
  const cart = getCart();
  if(!cart[id]) return;
  const n = Math.max(0, parseInt(val||'0', 10) || 0);
  if(n === 0) delete cart[id]; else cart[id].qty = n;
  setCart(cart);
}

function removeItem(id){
  const cart = getCart();
  delete cart[id];
  setCart(cart);
}

function clearCart(){
  localStorage.removeItem('cart');
  render();
}

function render(){
  const cart = getCart();
  updateMiniCount();
  const rows = [];
  let total = 0;

  const keys = Object.keys(cart);
  const empty = document.getElementById('empty');
  const table = document.getElementById('cartTable');
  const body = document.getElementById('cartBody');
  const summary = document.getElementById('summary');
  const grand = document.getElementById('grandTotal');

  if(keys.length === 0){
    empty.style.display = '';
    table.style.display = 'none';
    summary.style.display = 'none';
    return;
  }

  empty.style.display = 'none';
  table.style.display = '';
  summary.style.display = '';

  body.innerHTML = '';

  keys.forEach(id => {
    const it = cart[id];
    const lineTotal = (it.price||0) * (it.qty||0);
    total += lineTotal;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>
        <div class="item">
          <img src="${it.img||''}" alt="${it.title||''}">
          <div>
            <div style="font-weight:600">${it.title||''}</div>
            <div class="hide-sm" style="color:#6b7280;font-size:.9rem;">${it.price}€ / unité</div>
          </div>
        </div>
      </td>
      <td class="hide-sm">${it.price}€</td>
      <td>
        <div class="qty">
          <button type="button" aria-label="diminuer" data-act="dec" data-id="${id}">−</button>
          <input type="text" value="${it.qty||0}" data-act="set" data-id="${id}" inputmode="numeric" pattern="[0-9]*" />
          <button type="button" aria-label="augmenter" data-act="inc" data-id="${id}">+</button>
        </div>
      </td>
      <td>${formatEuro(lineTotal).replace(',00','')} </td>
      <td class="row-actions"><button class="remove" data-act="del" data-id="${id}">Supprimer</button></td>
    `;
    body.appendChild(tr);
  });

  grand.textContent = 'Total : ' + formatEuro(total).replace(',00','');
}

document.getElementById('cartBody').addEventListener('click', (e)=>{
  const b = e.target.closest('button');
  if(!b) return;
  const id = b.dataset.id;
  const act = b.dataset.act;
  if(act === 'dec') changeQty(id, -1);
  if(act === 'inc') changeQty(id, +1);
  if(act === 'del') removeItem(id);
});

document.getElementById('cartBody').addEventListener('input', (e)=>{
  const el = e.target;
  if(el && el.dataset.act === 'set'){
    setQty(el.dataset.id, el.value);
  }
});

document.getElementById('clear').addEventListener('click', clearCart);

render();
</script>
</body>
</html>
