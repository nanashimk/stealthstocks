<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="referrer" content="no-referrer" />
  <title>StealthShop</title>
  <style>
    :root { --gray:#e5e7eb; --soft:#f3f4f6; --shadow:0 8px 28px rgba(0,0,0,.08); --brand:#6d5cff; }
    *{box-sizing:border-box} body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;color:#111}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--gray);z-index:10}
    .bar{max-width:1060px;margin:0 auto;padding:14px 16px;display:flex;gap:12px;align-items:center}
    .logo{font-weight:800} .spacer{flex:1}
    .search{flex:1;max-width:520px;padding:10px 12px;border:1px solid var(--gray);border-radius:10px}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--gray);padding:8px 12px;border-radius:999px;text-decoration:none;color:#111}
    .pill.active{background:var(--brand);color:#fff;border-color:var(--brand)}
    main{max-width:1060px;margin:0 auto;padding:18px 16px 64px}
    /* shop grid */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:16px}
    .card{border:1px solid var(--gray);border-radius:16px;overflow:hidden;background:#fff;box-shadow:var(--shadow)}
    .card img{width:100%;aspect-ratio:1/1;object-fit:cover;display:block}
    .cap{display:flex;align-items:end;justify-content:space-between;padding:8px 10px;background:#fff}
    .title{font-size:14px;line-height:1.2;max-width:70%}
    .price{font-weight:700}
    .add{width:100%;border:0;border-top:1px solid var(--gray);padding:10px;cursor:pointer;background:#fff}
    .add:hover{background:var(--soft)}
    /* cart */
    table{width:100%;border-collapse:collapse} th,td{padding:10px;border-bottom:1px solid var(--gray);vertical-align:middle}
    .qty{display:inline-flex;border:1px solid var(--gray);border-radius:10px;overflow:hidden}
    .qty button{border:0;background:#fff;width:32px;height:32px;cursor:pointer}
    .qty input{width:40px;border:0;text-align:center}
    .right{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}
    .btn{border:1px solid var(--gray);background:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    /* checkout */
    .form{max-width:720px;margin:0 auto;display:grid;gap:12px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .form input, .form select{padding:10px 12px;border:1px solid var(--gray);border-radius:10px;width:100%}
    .muted{opacity:.7}
    .hidden{display:none}
    footer.nav{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#fff;border:1px solid var(--gray);border-radius:999px;box-shadow:var(--shadow);padding:8px;display:flex;gap:8px}
  </style>
</head>
<body>
<header>
  <div class="bar">
    <div class="logo">StealthShop</div>
    <input id="q" class="search" placeholder="Rechercher un produit…">
    <div class="spacer"></div>
    <a href="#shop" id="navShop" class="pill">Boutique</a>
    <a href="#cart" id="navCart" class="pill">Panier <span id="cartCount" class="muted">(0)</span></a>
    <a href="#checkout" id="navCheckout" class="pill">Paiement</a>
  </div>
</header>

<main>
  <!-- Boutique -->
  <section id="view-shop">
    <div id="empty" class="muted" hidden>Aucun résultat.</div>
    <div id="grid" class="grid"></div>
  </section>

  <!-- Panier -->
  <section id="view-cart" class="hidden">
    <h2>Panier</h2>
    <div id="cartEmpty" class="muted">Votre panier est vide.</div>
    <table id="cartTable" class="hidden">
      <thead><tr><th>Produit</th><th>Prix</th><th>Qté</th><th>Total</th><th></th></tr></thead>
      <tbody id="cartBody"></tbody>
    </table>
    <div class="right">
      <div id="cartTotal" class="muted"></div>
      <a href="#checkout" class="btn primary">Aller au paiement</a>
    </div>
  </section>

  <!-- Paiement -->
  <section id="view-checkout" class="hidden">
    <h2>Paiement</h2>
    <p class="muted" id="checkoutInfo"></p>
    <form id="payForm" class="form">
      <div class="row">
        <input required placeholder="Prénom" id="firstName">
        <input required placeholder="Nom" id="lastName">
      </div>
      <input required type="email" placeholder="Email" id="email">
      <input required placeholder="Adresse" id="addr">
      <div class="row">
        <input required placeholder="Ville" id="city">
        <input required placeholder="Code postal" id="zip">
      </div>
      <div class="row">
        <input required placeholder="Numéro de carte (fake ok)" id="cc">
        <input required placeholder="MM/AA CVC" id="exp">
      </div>
      <div class="right">
        <button type="submit" class="btn primary">Payer maintenant</button>
      </div>
    </form>
    <div id="paid" class="hidden">
      <h3>Merci !</h3>
      <p>Votre commande a bien été enregistrée. Un email de confirmation sera envoyé à <span id="paidEmail"></span>.</p>
      <a href="#shop" class="btn">Retour à la boutique</a>
    </div>
  </section>
</main>

<footer class="nav">
  <a href="#shop" class="pill" id="fShop">Boutique</a>
  <a href="#cart" class="pill" id="fCart">Panier</a>
  <a href="#checkout" class="pill" id="fChk">Paiement</a>
</footer>

<!-- === COLLE ICI TON CATALOGUE COMPLET (grosse liste JSON) === -->
<script id="catalog-data" type="application/json">
[
  {"id":"doudoune-palace","title":"Doudoune PALACE","price":80,"images":["https://si.geilicdn.com/open1673632073-252808396-6410000001999439a9140a8115c2_600_600.jpg"]},
  {"id":"ensemble-reflectif-nike-x-corteiz","title":"ensemble reflectif nike x corteiz","price":100,"images":["https://si.geilicdn.com/wdseller1580621215-05df000001955a6722770a20e2c5_828_1022.jpg"]}
]
</script>

<script>
(function(){
  // ---- utils storage
  const CART_KEY = "stealthshop.cart";
  const $ = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);

  let catalog = [];
  try {
    catalog = JSON.parse(document.getElementById('catalog-data').textContent);
  } catch(e){ console.warn("JSON catalogue invalide", e); catalog = []; }

  const state = {
    q: "", cart: loadCart(),
    route: (location.hash.replace('#','')||'shop')
  };

  function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY)||"{}"); }catch{ return {}; } }
  function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(state.cart)); updateBadges(); }

  function format€(n){ return Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(n); }

  // ---- boutique
  const grid = $('#grid'), q = $('#q'), empty = $('#empty');

  function renderGrid(list){
    grid.innerHTML='';
    if(!list.length){ empty.hidden=false; return; }
    empty.hidden=true;
    list.forEach(p=>{
      const fig=document.createElement('figure'); fig.className='card';
      const img=(p.images&&p.images[0])||'';
      fig.innerHTML = `
        <img class="thumb" src="${img}" alt="${p.title}" referrerpolicy="no-referrer" loading="lazy">
        <div class="cap">
          <div class="title">${p.title}</div>
          <div class="price">${p.price} €</div>
        </div>
        <button class="add" data-id="${p.id}">+ Panier</button>
      `;
      fig.querySelector('.add').onclick = () => addToCart(p.id,1);
      grid.appendChild(fig);
    });
    grid.querySelectorAll('img.thumb').forEach(img=>{
      img.onerror=()=>{ img.style.opacity=.15; img.title="Image indisponible"; };
    });
  }

  function filter(){
    const v = q.value.trim().toLowerCase();
    const list = !v ? catalog : catalog.filter(p =>
      (p.title||'').toLowerCase().includes(v) || (p.id||'').toLowerCase().includes(v)
    );
    renderGrid(list);
  }

  // ---- panier
  const cartBody = $('#cartBody'), cartTable=$('#cartTable'), cartEmpty=$('#cartEmpty'), cartTotal=$('#cartTotal');

  function addToCart(id,qty=1){
    state.cart[id]=(state.cart[id]||0)+qty;
    if(state.cart[id]<=0) delete state.cart[id];
    saveCart(); if(location.hash!=='#cart') flashCart(); renderCart();
  }
  function removeFromCart(id){ delete state.cart[id]; saveCart(); renderCart(); }
  function setQty(id,qty){ if(qty<=0) removeFromCart(id); else { state.cart[id]=qty; saveCart(); renderCart(); } }

  function renderCart(){
    const entries = Object.entries(state.cart);
    if(entries.length===0){ cartEmpty.classList.remove('hidden'); cartTable.classList.add('hidden'); cartTotal.textContent=''; return; }
    cartEmpty.classList.add('hidden'); cartTable.classList.remove('hidden');
    cartBody.innerHTML='';
    let total=0;
    entries.forEach(([id,qty])=>{
      const p=catalog.find(x=>x.id===id); if(!p) return;
      const line = p.price*qty; total+=line;
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td><div style="display:flex;gap:10px;align-items:center">
          <img src="${(p.images&&p.images[0])||''}" referrerpolicy="no-referrer" style="width:54px;height:54px;object-fit:cover;border-radius:8px">
          <div>${p.title}</div>
        </div></td>
        <td>${format€(p.price)}</td>
        <td>
          <div class="qty">
            <button aria-label="moins">−</button>
            <input value="${qty}" inputmode="numeric" />
            <button aria-label="plus">+</button>
          </div>
        </td>
        <td>${format€(line)}</td>
        <td><button class="btn" aria-label="supprimer">✕</button></td>
      `;
      const [btnM,input,btnP] = tr.querySelectorAll('.qty > *');
      btnM.onclick = ()=> setQty(id, Math.max(0, parseInt(input.value||1)-1));
      btnP.onclick = ()=> setQty(id, parseInt(input.value||1)+1);
      input.onchange = ()=> setQty(id, Math.max(0, parseInt(input.value||0)));
      tr.querySelector('td:last-child button').onclick = ()=> removeFromCart(id);
      cartBody.appendChild(tr);
    });
    cartTotal.textContent = "Total : "+format€(total);
    $('#checkoutInfo').textContent = `Montant à régler : ${format€(total)} (${entries.length} article${entries.length>1?'s':''}).`;
  }

  function updateBadges(){
    const n = Object.values(state.cart).reduce((a,b)=>a+b,0);
    $('#cartCount').textContent = `(${n})`;
  }

  function flashCart(){
    $('#navCart').classList.add('active');
    setTimeout(()=>$('#navCart').classList.remove('active'),700);
  }

  // ---- paiement (fake)
  const payForm = $('#payForm'), paidBox = $('#paid'), paidEmail = $('#paidEmail');
  payForm.addEventListener('submit', e=>{
    e.preventDefault();
    if(Object.keys(state.cart).length===0){ alert("Votre panier est vide."); return; }
    paidEmail.textContent = $('#email').value || '';
    // “valide” la commande
    state.cart = {}; saveCart(); renderCart();
    payForm.classList.add('hidden'); paidBox.classList.remove('hidden');
  });

  // ---- navigation
  const views = {
    shop: $('#view-shop'),
    cart: $('#view-cart'),
    checkout: $('#view-checkout'),
  };
  function setRoute(r){
    state.route = r || 'shop';
    Object.entries(views).forEach(([k,el])=>{
      el.classList.toggle('hidden', k!==state.route);
    });
    // activer badges nav
    ['navShop','navCart','navCheckout','fShop','fCart','fChk'].forEach(id=>$('#'+id).classList.remove('active'));
    if(r==='shop'){ $('#navShop').classList.add('active'); $('#fShop').classList.add('active'); }
    if(r==='cart'){ $('#navCart').classList.add('active'); $('#fCart').classList.add('active'); }
    if(r==='checkout'){ $('#navCheckout').classList.add('active'); $('#fChk').classList.add('active'); }
  }
  window.addEventListener('hashchange', ()=> setRoute(location.hash.replace('#','')));

  // ---- boot
  q.addEventListener('input', filter);
  renderGrid(catalog);
  renderCart();
  updateBadges();
  setRoute(state.route);
})();
</script>
</body>
</html>
